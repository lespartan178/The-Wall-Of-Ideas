<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>The Wall of Ideas</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
  body { font-family: Arial, sans-serif; margin:20px; }
  .idea {
    border: 2px solid #ccc; 
    padding: 10px; 
    margin-bottom:10px; 
    border-radius:5px;
    transition: transform 0.3s ease;
  }
  .idea:hover {
    transform: scale(1.05);
  }
  .like-btn {
    padding: 5px 10px; 
    cursor: pointer; 
    background: #2196f3; 
    color: white; 
    border: none; 
    border-radius: 3px;
  }
  .like-btn.disabled { background: #aaa; cursor: default; }
  #login-btn, #logout-btn { margin-bottom: 20px; padding: 10px 20px; cursor:pointer; }
  a.author-channel {
    color: inherit;
    text-decoration: underline;
  }
</style>
</head>
<body>

<button id="login-btn">Se connecter avec Google</button>
<button id="logout-btn" style="display:none;">Se d√©connecter</button>

<div id="ideas-container"></div>

<script>
  // Config Firebase - remplace par ta config perso
  const firebaseConfig = {
    apiKey: "AIzaSyDcFd8YZqGtN3ekwcgxPdgR0kdvGMhUDlw",
    authDomain: "thewallofideas.firebaseapp.com",
    projectId: "thewallofideas",
    storageBucket: "thewallofideas.firebasestorage.app",
    messagingSenderId: "705936042775",
    appId: "1:705936042775:web:5454fdcbf0a8c2efd2e552"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  const loginBtn = document.getElementById('login-btn');
  const logoutBtn = document.getElementById('logout-btn');
  const container = document.getElementById('ideas-container');

  // Fonction pour g√©n√©rer une couleur si non d√©finie (au cas o√π)
  function randomColor() {
    const letters = '0123456789ABCDEF';
    let color = '#';
    for(let i=0; i<6; i++) {
      color += letters[Math.floor(Math.random()*16)];
    }
    return color;
  }

  async function loadIdeas(user) {
    container.innerHTML = "Chargement...";
    const snapshot = await db.collection('ideas').orderBy('number').get();

    container.innerHTML = '';
    snapshot.forEach(async doc => {
      const idea = doc.data();
      const ideaId = doc.id;

      // Si pas de couleur, on en g√©n√®re une (optionnel)
      const color = idea.color || randomColor();

      // V√©rifier si l'utilisateur a d√©j√† lik√© cette id√©e
      let userLiked = false;
      if(user) {
        const likeDoc = await db.collection('ideas').doc(ideaId)
          .collection('likes').doc(user.uid).get();
        userLiked = likeDoc.exists;
      }

      // Cr√©ation √©l√©ment id√©e
      const div = document.createElement('div');
      div.className = 'idea';
      div.style.borderColor = color;

      div.innerHTML = `
        <p><strong>#${idea.number} - <a class="author-channel" href="${idea.authorChannel || '#'}" target="_blank" rel="noopener noreferrer">${idea.author}</a></strong> (${idea.language || 'inconnu'})</p>
        <p>${idea.text}</p>
        <button class="like-btn ${userLiked ? 'disabled' : ''}" ${userLiked ? 'disabled' : ''}>
          üëç Like (${idea.likesCount || 0})
        </button>
      `;

      const likeBtn = div.querySelector('button');

      if (!user) {
        likeBtn.disabled = true;
        likeBtn.title = "Connectez-vous pour liker";
      }

      likeBtn.onclick = async () => {
        if (!user) {
          alert("Connectez-vous pour liker !");
          return;
        }
        if (userLiked) return;

        try {
          await db.runTransaction(async (transaction) => {
            const ideaRef = db.collection('ideas').doc(ideaId);
            const likeRef = ideaRef.collection('likes').doc(user.uid);

            const ideaDoc = await transaction.get(ideaRef);
            if (!ideaDoc.exists) throw "Id√©e inexistante";

            const currentLikes = ideaDoc.data().likesCount || 0;

            const likeDoc = await transaction.get(likeRef);
            if (likeDoc.exists) throw "Vous avez d√©j√† lik√©";

            transaction.set(likeRef, { likedAt: new Date() });
            transaction.update(ideaRef, { likesCount: currentLikes + 1 });
          });
          alert("Merci pour votre like !");
          loadIdeas(user); // Recharger pour mettre √† jour l'affichage
        } catch(e) {
          alert("Erreur ou d√©j√† lik√© : " + e);
        }
      };

      container.appendChild(div);
    });
  }

  loginBtn.onclick = () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider);
  };
  logoutBtn.onclick = () => auth.signOut();

  auth.onAuthStateChanged(user => {
    if(user) {
      loginBtn.style.display = 'none';
      logoutBtn.style.display = 'inline-block';
      loadIdeas(user);
    } else {
      loginBtn.style.display = 'inline-block';
      logoutBtn.style.display = 'none';
      loadIdeas(null);
    }
  });
</script>

</body>
</html>


  </script>
</body>
</html>
